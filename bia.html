<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Brothers in Arms</title>
  <meta name="description" content="Brothers in Arms event hub: banner, countdown, and lyric video." />
  <style>
    :root{--bg:#0b1020;--panel:#0f1724;--ink:#ffffff;--muted:#9aa4b2;--a:#8b5cf6;--b:#06b6d4}
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#08111f);color:var(--ink);
      font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}

    .wrap{max-width:1040px;margin:0 auto;padding:16px 20px}
    @media (max-width:480px){ .wrap{padding:14px 16px} }

    /* Hero (shorter, shows next section) */
    .bia-hero{width:100%;min-height:220px;display:grid;place-items:center;position:relative;overflow:hidden}
    @media (min-width:900px){ .bia-hero{min-height:260px} }
    .bia-hero::before{
      content:"";position:absolute;inset:0;
      background:#0b1020 url('assets/bia_banner_final_1920x500.png') center/cover no-repeat;
      filter:contrast(1.05) saturate(1.02);z-index:0
    }
    .bia-hero::after{
      content:"";position:absolute;inset:0;
      background:linear-gradient(180deg,rgba(0,0,0,.25),rgba(0,0,0,.6));z-index:0
    }
    .bia-hero-inner{position:relative;z-index:1;text-align:center;padding:40px 20px 44px}
    .bia-title{font-size:40px;margin:0 0 4px;letter-spacing:.3px;color:#fff;text-shadow:0 3px 12px rgba(0,0,0,.55)}
    @media (max-width:600px){ .bia-title{font-size:32px} }
    .bia-tag{color:#e7ecff;font-weight:700;opacity:.95}

    /* Panels */
    .card{
      background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.04));
      border:1px solid rgba(255,255,255,0.08);
      border-radius:14px;padding:14px 16px;margin-top:12px
    }
    /* Overlap the countdown slightly onto hero */
    .card.overlap{margin-top:-20px}

    /* Countdown: compact */
    .stack{display:flex;align-items:center;gap:14px;flex-wrap:wrap}
    .status-pill{
      padding:6px 10px;border-radius:999px;
      background:rgba(139,92,246,.18);
      border:1px solid rgba(139,92,246,.35);
      font-weight:800;font-size:13px;white-space:nowrap
    }
    .timer{font-size:36px;font-weight:900;letter-spacing:.5px}
    @media (max-width:600px){ .timer{font-size:30px} }
    .meta{color:var(--muted);font-size:13px}
    .grow{flex:1}

    /* Video */
    .video-wrap{height:0; padding-bottom:56.25%; position:relative; width:100%;}
    .video-wrap iframe{position:absolute; inset:0; width:100%; height:100%; border:0}
    h2{margin:6px 0 10px; font-size:20px}
  </style>
</head>
<body>
  <!-- Shared nav -->
  <div id="nav-placeholder"></div>
  <script>
    fetch('nav.html').then(r=>r.text()).then(h=>{ document.getElementById('nav-placeholder').innerHTML=h; });
  </script>

  <!-- Hero -->
  <section class="bia-hero" aria-label="Brothers in Arms banner">
    <div class="bia-hero-inner">
      <h1 class="bia-title">BROTHERS IN ARMS</h1>
      <div class="bia-tag">Shields first, tears later.</div>
    </div>
  </section>

  <main class="wrap" role="main">
    <!-- Countdown / Status (overlaps hero) -->
    <section class="card overlap" aria-labelledby="clock-h">
      <h2 id="clock-h">Countdown</h2>
      <div class="stack">
        <span id="status-pill" class="status-pill">Checking…</span>
        <div id="count" class="timer">--:--:--</div>
        <div class="grow"></div>
        <div class="meta" id="when-line"></div>
      </div>
      <div class="meta" style="margin-top:6px;">Repeats every 28 days (UTC cycle).</div>
    </section>

    <!-- Lyric Video (should be visible above the fold now) -->
    <section class="card" aria-labelledby="video-h">
      <h2 id="video-h">Brothers in Arms — Official Lyric Video</h2>
      <div class="video-wrap">
        <iframe
          allow="autoplay; gyroscope;"
          allowfullscreen
          referrerpolicy="strict-origin"
          src="https://www.kapwing.com/e/68d6233528114e6adc9c918d"
          title="Brothers in Arms Lyric Video">
        </iframe>
      </div>
      <p class="meta" style="text-align:right;margin-top:6px;">Video edited on <a href="https://www.kapwing.com/video-editor" target="_blank" rel="noopener">Kapwing</a></p>
    </section>
  </main>

  <!-- Shared footer -->
  <div id="footer-placeholder"></div>
  <script>
    fetch('footer.html').then(r=>r.text()).then(h=>{ document.getElementById('footer-placeholder').innerHTML=h; });

    // ===== Countdown logic (recurs every 28 days) =====
    const ANCHOR_START_UTC = Date.parse('2025-09-26T00:00:00Z');   // anchor for the cycle
    const WINDOW_MS = 2 * 24 * 60 * 60 * 1000;                      // 48 hours
    const PERIOD_MS = 28 * 24 * 60 * 60 * 1000;                      // 28 days

    function windowFor(now = Date.now()){
      const n = Math.floor((now - ANCHOR_START_UTC)/PERIOD_MS);
      const base = ANCHOR_START_UTC + Math.max(n,0)*PERIOD_MS;
      const start = base;
      const end = base + WINDOW_MS;
      if (now < start) return {state:'before', start, end};
      if (now <= end)  return {state:'live',   start, end};
      const nextStart = base + PERIOD_MS;
      return {state:'after', start: nextStart, end: nextStart + WINDOW_MS};
    }

    const $pill  = document.getElementById('status-pill');
    const $count = document.getElementById('count');
    const $when  = document.getElementById('when-line');

    function fmtHMS(ms){
      const s = Math.floor(ms/1000);
      const h = Math.floor(s/3600);
      const m = Math.floor((s%3600)/60);
      const ss= s%60;
      return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;
    }
    const fmtLocal = ts => new Date(ts).toLocaleString();
    const fmtUTC   = ts => new Date(ts).toISOString().replace('T',' ').replace(':00.000Z',' UTC');

    function tick(){
      const now = Date.now();
      const w = windowFor(now);

      let label, target;
      if (w.state === 'live'){ label='LIVE WINDOW'; target = w.end; }
      else { label='NEXT WINDOW'; target = w.start; }

      $pill.textContent = label;
      $count.textContent = fmtHMS(Math.max(0, target - now));
      $when.textContent = `Local: ${fmtLocal(w.start)} → ${fmtLocal(w.end)}  •  UTC: ${fmtUTC(w.start)} → ${fmtUTC(w.end)}`;
    }
    tick();
    setInterval(tick, 1000);
  </script>
</body>
</html>
